<!DOCTYPE html>
<html>
<head>
    <title>Ransomware Detector</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .upload-area { border: 2px dashed #ccc; padding: 40px; text-align: center; margin: 20px 0; }
        .result { margin-top: 20px; padding: 20px; border-radius: 5px; }
        .malicious { background-color: #ffebee; border-left: 5px solid #f44336; }
        .benign { background-color: #e8f5e9; border-left: 5px solid #4caf50; }
        button { background-color: #2196f3; color: white; border: none; padding: 10px 20px; cursor: pointer; }
        button:hover { background-color: #0b7dda; }
        .loading { display: none; text-align: center; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Ransomware Detection System</h1>
    <p>Upload a Windows executable (.exe) file for analysis</p>
    
    <div class="upload-area" id="dropArea">
        <p>Drag & drop your file here or click to browse</p>
        <input type="file" id="fileInput" accept=".exe,.dll">
        <button onclick="document.getElementById('fileInput').click()">Browse Files</button>
    </div>
    
    <div class="loading" id="loading">
        <p>üîç Analyzing file...</p>
    </div>
    
    <div class="result" id="result" style="display: none;"></div>
    
    <script>
        const fileInput = document.getElementById('fileInput');
        const dropArea = document.getElementById('dropArea');
        const loading = document.getElementById('loading');
        const resultDiv = document.getElementById('result');
        
        fileInput.addEventListener('change', handleFile);
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, preventDefaults, false);
        });
        
        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
        
        ['dragenter', 'dragover'].forEach(eventName => {
            dropArea.addEventListener(eventName, highlight, false);
        });
        
        ['dragleave', 'drop'].forEach(eventName => {
            dropArea.addEventListener(eventName, unhighlight, false);
        });
        
        function highlight() {
            dropArea.style.borderColor = '#2196f3';
            dropArea.style.backgroundColor = '#f5f5f5';
        }
        
        function unhighlight() {
            dropArea.style.borderColor = '#ccc';
            dropArea.style.backgroundColor = 'transparent';
        }
        
        dropArea.addEventListener('drop', handleDrop, false);
        
        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            fileInput.files = files;
            handleFile();
        }
        
        function handleFile() {
            const file = fileInput.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            
            loading.style.display = 'block';
            resultDiv.style.display = 'none';
            
            fetch('/upload', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                // First, check if the response is JSON
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    // If not JSON, get the text to see what error occurred
                    return response.text().then(text => {
                        throw new Error(`Server returned: ${text.substring(0, 100)}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                loading.style.display = 'none';
                
                if (data.error) {
                    resultDiv.innerHTML = `<h3>‚ùå Error</h3><p>${data.error}</p>`;
                    resultDiv.className = 'result error';
                } else {
                    const isMalicious = data.prediction === 'MALICIOUS';
                    resultDiv.className = `result ${isMalicious ? 'malicious' : 'benign'}`;
                    
                    resultDiv.innerHTML = `
                        <h2>${isMalicious ? 'üö® MALICIOUS' : '‚úÖ BENIGN'}</h2>
                        <p><strong>Confidence:</strong> ${(data.confidence * 100).toFixed(1)}%</p>
                        <p><strong>Details:</strong></p>
                        <ul>
                            <li>Probability of being benign: ${(data.probabilities.benign * 100).toFixed(1)}%</li>
                            <li>Probability of being malicious: ${(data.probabilities.malicious * 100).toFixed(1)}%</li>
                        </ul>
                    `;
                }
                
                resultDiv.style.display = 'block';
            })
            .catch(error => {
                loading.style.display = 'none';
                resultDiv.innerHTML = `<h3>‚ùå Request Failed</h3><p>${error.message}</p><p>Please check the console for details.</p>`;
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                console.error('Upload error:', error);
            });
        }
    </script>
</body>
</html>